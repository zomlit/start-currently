console.log("ðŸŽ® Offscreen script starting");const{config:e}=await import("./dist/config.js");let n=null,s=null,t=!1,a=null,o=null;const r=1e3/120;let i=0,d=null,l=new Map;function c(){try{const e=performance.now();if(e-i<r)return void(d=requestAnimationFrame(c));const n=navigator.getGamepads()[0];if(n){const t={buttons:n.buttons.map(((n,s)=>{const t=l.get(s),o=n.pressed;return o?(l.set(s,{pressed:!0,timestamp:e,value:n.value||1}),{pressed:!0,value:n.value||1}):(o||t?.pressed&&(l.delete(s),a=null),{pressed:!1,value:0})})),axes:n.axes.map((e=>{const n=Math.abs(e);if(n<.15)return 0;const s=Math.sign(e)*((n-.15)/.85);return Number(s.toFixed(3))})),timestamp:e},o=t.buttons.some((e=>e.pressed))||t.axes.some((e=>Math.abs(e)>0)),r=a?.buttons.some(((e,n)=>e.pressed&&!t.buttons[n].pressed));(o||r||!a)&&(chrome.runtime.sendMessage({type:"GAMEPAD_STATE",state:t,timestamp:e}),s&&s.send({type:"broadcast",event:"gamepadState",payload:{gamepadState:t}}).catch((e=>console.error("Supabase send error:",e))),a=t),i=e}d=requestAnimationFrame(c)}catch(e){console.error("Poll error:",e),d=requestAnimationFrame(c)}}chrome.runtime.onMessage.addListener((r=>{"INIT_CHANNEL"===r.type&&(console.log("Received channel ID:",r.channelId),async function(r){if(t)console.log("Already initialized, skipping...");else try{console.log("Using channel:",r),n||(n=window.supabase.createClient(e.SUPABASE_URL,e.SUPABASE_ANON_KEY)),s&&await s.unsubscribe(),s=n.channel(r).subscribe((e=>console.log("Supabase status:",e))),o&&clearInterval(o),o=setInterval(c,16),window.addEventListener("gamepadconnected",(e=>{console.log("ðŸŽ® Gamepad connected:",{id:e.gamepad.id,index:e.gamepad.index})})),window.addEventListener("gamepaddisconnected",(e=>{console.log("ðŸŽ® Gamepad disconnected:",{id:e.gamepad.id,index:e.gamepad.index}),a=null})),t=!0}catch(e){console.error("Initialization error:",e)}}(r.channelId))})),chrome.runtime.sendMessage({type:"GET_CHANNEL_ID"});